<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ì‹œë³´ë“œ - Instagram AI Marketing</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .instagram-preview {
            max-width: 375px;
            margin: 0 auto;
            border: 1px solid #dbdbdb;
            border-radius: 12px;
            overflow: hidden;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .instagram-header {
            padding: 12px 16px;
            border-bottom: 1px solid #efefef;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .profile-pic {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .instagram-image {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
        }
        
        .instagram-actions {
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .instagram-content {
            padding: 0 16px 16px;
        }
        
        .instagram-caption {
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 8px;
        }
        
        .instagram-hashtags {
            font-size: 13px;
            color: #00376b;
            line-height: 1.3;
        }
        
        .content-editor {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
        }
        
        .floating-preview {
            position: sticky;
            top: 20px;
        }
        
        .content-stats {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .stat-item:last-child {
            border-bottom: none;
        }
        
        .feature-card {
            transition: transform 0.2s ease;
            border: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        
        .loading-spinner {
            display: none;
        }
        
        .loading .loading-spinner {
            display: inline-block;
        }
        
        .loading .button-text {
            display: none;
        }
        
        .badge-custom {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            padding: 4px 12px;
            font-size: 12px;
        }
    </style>
</head>
<body class="bg-light">
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/">
                ğŸš€ Instagram AI Marketing
            </a>
            
            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <span id="user-name">ì‚¬ìš©ì</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" onclick="showProfile()">ğŸ‘¤ í”„ë¡œí•„</a></li>
                        <li><a class="dropdown-item" href="#" onclick="showSettings()">âš™ï¸ ì„¤ì •</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid py-4">
        <div class="row">
            <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
            <div class="col-lg-8">
                <!-- ì½˜í…ì¸  ìƒì„± ì¹´ë“œ -->
                <div class="card feature-card mb-4">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">ğŸ¤– AI ì½˜í…ì¸  ìƒì„±</h5>
                        <span class="badge-custom">GPT-3.5</span>
                    </div>
                    <div class="card-body">
                        <form id="content-form">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="business-name" class="form-label fw-bold">ë¹„ì¦ˆë‹ˆìŠ¤ ì´ë¦„</label>
                                    <input type="text" class="form-control" id="business-name" name="business-name" required placeholder="ì˜ˆ: í™ê¸¸ë™ì¹´í˜">
                                </div>
                                <div class="col-md-6">
                                    <label for="industry" class="form-label fw-bold">ì—…ì¢…</label>
                                    <select class="form-select" id="industry" name="industry" required>
                                        <option value="">ì—…ì¢… ì„ íƒ</option>
                                        <option value="restaurant">ğŸ½ï¸ ìŒì‹ì /ì¹´í˜</option>
                                        <option value="fashion">ğŸ‘” íŒ¨ì…˜/ì˜ë¥˜</option>
                                        <option value="beauty">ğŸ’„ ë·°í‹°/í™”ì¥í’ˆ</option>
                                        <option value="fitness">ğŸ’ª í”¼íŠ¸ë‹ˆìŠ¤/í—¬ìŠ¤</option>
                                        <option value="retail">ğŸ›ï¸ ì†Œë§¤/ì‡¼í•‘</option>
                                        <option value="tech">ğŸ’» IT/í…Œí¬</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-bold">íƒ€ê²Ÿ ê³ ê°</label>
                                    <input type="text" class="form-control" id="target" placeholder="20-30ëŒ€ ì§ì¥ì¸">
                                </div>
                                <div class="col-md-6">
                                    <label for="brand-voice" class="form-label fw-bold">ë¸Œëœë“œ í†¤</label>
                                    <select class="form-select" id="brand-voice" name="brand-voice" required>
                                        <option value="">ë¸Œëœë“œ í†¤ ì„ íƒ</option>
                                        <option value="ì¹œê·¼í•˜ê³  ë”°ëœ»í•œ">ì¹œê·¼í•˜ê³  ë”°ëœ»í•œ</option>
                                        <option value="ì „ë¬¸ì ì´ê³  ì‹ ë¢°ê° ìˆëŠ”">ì „ë¬¸ì ì´ê³  ì‹ ë¢°ê° ìˆëŠ”</option>
                                        <option value="ì Šê³  íŠ¸ë Œë””í•œ">ì Šê³  íŠ¸ë Œë””í•œ</option>
                                        <option value="ê³ ê¸‰ìŠ¤ëŸ½ê³  ì„¸ë ¨ëœ">ê³ ê¸‰ìŠ¤ëŸ½ê³  ì„¸ë ¨ëœ</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row mt-4">
                                <div class="col-md-4">
                                    <button type="submit" class="btn btn-primary w-100">
                                        <span class="loading-spinner spinner-border spinner-border-sm me-2"></span>
                                        <span class="button-text">ğŸ¨ ì½˜í…ì¸  ìƒì„±</span>
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-success w-100" onclick="regenerateContent()">
                                        <span class="loading-spinner spinner-border spinner-border-sm me-2"></span>
                                        <span class="button-text">ğŸ”„ ë‹¤ì‹œ ìƒì„±</span>
                                    </button>
                                </div>
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-warning w-100" onclick="postToInstagram()" disabled id="post-btn">
                                        <span class="loading-spinner spinner-border spinner-border-sm me-2"></span>
                                        <span class="button-text">ğŸ“± Instagram í¬ìŠ¤íŒ…</span>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- ì½˜í…ì¸  í¸ì§‘ê¸° -->
                <div class="card feature-card" id="editor-card" style="display: none;">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">âœï¸ ì½˜í…ì¸  í¸ì§‘</h5>
                    </div>
                    <div class="card-body content-editor">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <label class="form-label fw-bold">ğŸ“ ìº¡ì…˜ í¸ì§‘</label>
                                <textarea id="caption-editor" class="form-control" rows="8" placeholder="ìƒì„±ëœ ìº¡ì…˜ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤..."></textarea>
                                <div class="d-flex justify-content-between mt-2">
                                    <small class="text-muted">
                                        <span id="caption-length">0</span>/2200 ì
                                    </small>
                                    <button class="btn btn-sm btn-outline-primary" onclick="optimizeCaption()">
                                        âœ¨ AI ìµœì í™”
                                    </button>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <label class="form-label fw-bold">ğŸ·ï¸ í•´ì‹œíƒœê·¸ í¸ì§‘</label>
                                <textarea id="hashtags-editor" class="form-control" rows="4" placeholder="#í•´ì‹œíƒœê·¸ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤..."></textarea>
                                <div class="d-flex justify-content-between mt-2">
                                    <small class="text-muted">
                                        <span id="hashtag-count">0</span>ê°œ í•´ì‹œíƒœê·¸
                                    </small>
                                    <button class="btn btn-sm btn-outline-success" onclick="suggestHashtags()">
                                        ğŸ¯ ì¶”ì²œ íƒœê·¸
                                    </button>
                                </div>
                                
                                <!-- ì´ë¯¸ì§€ URL í¸ì§‘ -->
                                <div class="mt-3">
                                    <label class="form-label fw-bold">ğŸ–¼ï¸ ì´ë¯¸ì§€ URL</label>
                                    <div class="input-group">
                                        <input type="url" id="image-url-editor" class="form-control" placeholder="ì´ë¯¸ì§€ URL">
                                        <button class="btn btn-outline-primary" onclick="changeImage()">ë³€ê²½</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-4">
                            <div class="btn-group">
                                <button class="btn btn-outline-secondary" onclick="resetContent()">
                                    ğŸ”„ ì´ˆê¸°í™”
                                </button>
                                <button class="btn btn-primary" onclick="updatePreview()">
                                    ğŸ‘€ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
                                </button>
                                <button class="btn btn-success" onclick="saveContent()">
                                    ğŸ’¾ ì €ì¥í•˜ê¸°
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë¯¸ë¦¬ë³´ê¸° ë° í†µê³„ ì˜ì—­ -->
            <div class="col-lg-4">
                <div class="floating-preview">
                    <!-- Instagram ë¯¸ë¦¬ë³´ê¸° -->
                    <div class="card feature-card mb-4" id="preview-card" style="display: none;">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0">ğŸ“± Instagram ë¯¸ë¦¬ë³´ê¸°</h6>
                        </div>
                        <div class="card-body text-center">
                            <div class="instagram-preview">
                                <!-- Instagram í—¤ë” -->
                                <div class="instagram-header">
                                    <div class="d-flex align-items-center">
                                        <div class="profile-pic me-2">
                                            B
                                        </div>
                                        <div>
                                            <div class="fw-bold" style="font-size: 14px;" id="preview-username">your_business</div>
                                            <div class="text-muted" style="font-size: 11px;">Sponsored</div>
                                        </div>
                                    </div>
                                    <div class="text-muted">â‹¯</div>
                                </div>
                                
                                <!-- Instagram ì´ë¯¸ì§€ -->
                                <img id="preview-image" 
                                     src="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?auto=format&fit=crop&w=400&q=80" 
                                     class="instagram-image"
                                     alt="Instagram post image">
                                
                                <!-- Instagram ì•¡ì…˜ ë²„íŠ¼ -->
                                <div class="instagram-actions">
                                    <span style="font-size: 24px;">ğŸ¤</span>
                                    <span style="font-size: 24px;">ğŸ’¬</span>
                                    <span style="font-size: 24px;">ğŸ“¤</span>
                                    <div class="ms-auto">
                                        <span style="font-size: 24px;">ğŸ”–</span>
                                    </div>
                                </div>
                                
                                <!-- Instagram ì½˜í…ì¸  -->
                                <div class="instagram-content">
                                    <div class="fw-bold mb-1" style="font-size: 14px;">1,234 likes</div>
                                    <div class="instagram-caption">
                                        <span class="fw-bold" id="preview-business-name">your_business</span>
                                        <span id="preview-caption">ìƒì„±ëœ ìº¡ì…˜ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</span>
                                    </div>
                                    <div class="instagram-hashtags" id="preview-hashtags">
                                        #í•´ì‹œíƒœê·¸ë“¤ì´ #ì—¬ê¸°ì— #í‘œì‹œë©ë‹ˆë‹¤
                                    </div>
                                    <div class="text-muted mt-2" style="font-size: 12px;">2 hours ago</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ì½˜í…ì¸  í†µê³„ -->
                    <div class="content-stats mb-4" id="stats-card" style="display: none;">
                        <h6 class="fw-bold mb-3">ğŸ“Š ì½˜í…ì¸  ë¶„ì„</h6>
                        
                        <div class="stat-item">
                            <span>ìº¡ì…˜ ê¸¸ì´</span>
                            <span class="fw-bold" id="stat-caption-length">0ì</span>
                        </div>
                        
                        <div class="stat-item">
                            <span>í•´ì‹œíƒœê·¸ ìˆ˜</span>
                            <span class="fw-bold" id="stat-hashtag-count">0ê°œ</span>
                        </div>
                        
                        <div class="stat-item">
                            <span>ì˜ˆìƒ ë„ë‹¬ë²”ìœ„</span>
                            <span class="fw-bold text-success" id="stat-reach">ë†’ìŒ</span>
                        </div>
                        
                        <div class="stat-item">
                            <span>ë°”ì´ëŸ´ ì ìˆ˜</span>
                            <span class="fw-bold text-primary" id="stat-viral-score">85/100</span>
                        </div>
                        
                        <div class="stat-item">
                            <span>ìµœì  í¬ìŠ¤íŒ… ì‹œê°„</span>
                            <span class="fw-bold text-info" id="stat-best-time">ì˜¤í›„ 7ì‹œ</span>
                        </div>

                        <div class="mt-3 pt-3 border-top">
                            <div class="d-grid gap-2">
                                <button class="btn btn-outline-primary btn-sm" onclick="copyContent()">
                                    ğŸ“‹ ì „ì²´ ë³µì‚¬
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="schedulePost()">
                                    â° ì˜ˆì•½ í¬ìŠ¤íŒ…
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ë¹ ë¥¸ ì•¡ì…˜ -->
                    <div class="card feature-card">
                        <div class="card-header bg-warning text-dark">
                            <h6 class="mb-0">âš¡ ë¹ ë¥¸ ì•¡ì…˜</h6>
                        </div>
                        <div class="card-body">
                            <div class="d-grid gap-2">
                                <button class="btn btn-sm btn-outline-primary" onclick="loadTemplate()">
                                    ğŸ“‹ í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸°
                                </button>
                                <button class="btn btn-sm btn-outline-success" onclick="showHistory()">
                                    ğŸ“š ìµœê·¼ ì½˜í…ì¸ 
                                </button>
                                <button class="btn btn-sm btn-outline-info" onclick="testInstagram()">
                                    ğŸ§ª Instagram í…ŒìŠ¤íŠ¸
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="showAnalytics()">
                                    ğŸ“ˆ ì„±ê³¼ ë¶„ì„
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì•Œë¦¼ ì»¨í…Œì´ë„ˆ -->
    <div id="toast-container" class="position-fixed bottom-0 end-0 p-3" style="z-index: 11"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentContent = {
            caption: '',
            hashtags: [],
            imageUrl: '',
            businessName: ''
        };

        // í˜ì´ì§€ ë¡œë“œì‹œ ì‚¬ìš©ì ì •ë³´ í™•ì¸
        document.addEventListener('DOMContentLoaded', async function() {
            await checkAuth();
            loadUserInfo();
        });

        // ì¸ì¦ í™•ì¸
        async function checkAuth() {
            try {
                const response = await fetch('/api/auth/me');
                if (!response.ok) {
                    window.location.href = '/login';
                    return;
                }
                const data = await response.json();
                if (data.success) {
                    document.getElementById('user-name').textContent = data.user.business_name;
                    document.getElementById('business-name').value = data.user.business_name;
                    document.getElementById('industry').value = data.user.industry;
                }
            } catch (error) {
                console.error('ì¸ì¦ í™•ì¸ ì˜¤ë¥˜:', error);
                window.location.href = '/login';
            }
        }

        // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
        function loadUserInfo() {
            // ì‚¬ìš©ìë³„ ì„¤ì • ë¡œë“œí•  ìˆ˜ ìˆìŒ
        }

        // ì½˜í…ì¸  ìƒì„± í¼ ì²˜ë¦¬
        document.getElementById('content-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            await generateContent();
        });

        // ì½˜í…ì¸  ìƒì„±
        async function generateContent() {
            const button = document.querySelector('#content-form button[type="submit"]');
            const businessName = document.getElementById('business-name').value;
            const industry = document.getElementById('industry').value;
            const target = document.getElementById('target').value;
            const brandVoice = document.getElementById('brand-voice').value;

            if (!businessName || !industry) {
                showToast('ë¹„ì¦ˆë‹ˆìŠ¤ ì´ë¦„ê³¼ ì—…ì¢…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            // ë¡œë”© ìƒíƒœ
            button.classList.add('loading');

            try {
                const response = await fetch('/api/generate-content', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        business_name: businessName,
                        industry: industry,
                        target_audience: target || 'ì¼ë°˜ ê³ ê°',
                        brand_voice: brandVoice
                    })
                });

                const data = await response.json();

                if (data.success) {
                    currentContent = {
                        caption: data.content.caption,
                        hashtags: data.content.hashtags,
                        imageUrl: data.content.image_url,
                        businessName: businessName
                    };

                    // í¸ì§‘ê¸°ì— ë‚´ìš© ì±„ìš°ê¸°
                    document.getElementById('caption-editor').value = currentContent.caption;
                    document.getElementById('hashtags-editor').value = currentContent.hashtags.join(' ');
                    document.getElementById('image-url-editor').value = currentContent.imageUrl;

                    // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
                    updatePreview();
                    
                    // ì¹´ë“œ í‘œì‹œ
                    document.getElementById('editor-card').style.display = 'block';
                    document.getElementById('preview-card').style.display = 'block';
                    document.getElementById('stats-card').style.display = 'block';
                    document.getElementById('post-btn').disabled = false;

                    showToast('ì½˜í…ì¸ ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰', 'success');
                } else {
                    showToast('ì½˜í…ì¸  ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'danger');
                }
            } catch (error) {
                showToast('ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
                console.error('ì½˜í…ì¸  ìƒì„± ì˜¤ë¥˜:', error);
            } finally {
                button.classList.remove('loading');
            }
        }

        // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updatePreview() {
            const caption = document.getElementById('caption-editor').value;
            const hashtags = document.getElementById('hashtags-editor').value;
            const imageUrl = document.getElementById('image-url-editor').value;
            const businessName = document.getElementById('business-name').value;

            // Instagram ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            document.getElementById('preview-caption').textContent = caption;
            document.getElementById('preview-hashtags').textContent = hashtags;
            document.getElementById('preview-business-name').textContent = businessName.toLowerCase().replace(/\s+/g, '_');
            document.getElementById('preview-username').textContent = businessName.toLowerCase().replace(/\s+/g, '_');
            
            if (imageUrl) {
                document.getElementById('preview-image').src = imageUrl;
            }

            // í”„ë¡œí•„ ì‚¬ì§„ ì²« ê¸€ì
            const profilePic = document.querySelector('.profile-pic');
            profilePic.textContent = businessName ? businessName.charAt(0).toUpperCase() : 'B';

            // í†µê³„ ì—…ë°ì´íŠ¸
            updateStats(caption, hashtags);

            // í˜„ì¬ ì½˜í…ì¸  ì €ì¥
            currentContent = {
                caption: caption,
                hashtags: hashtags.split(/\s+/).filter(tag => tag.trim()),
                imageUrl: imageUrl,
                businessName: businessName
            };
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats(caption, hashtags) {
            const captionLength = caption.length;
            const hashtagArray = hashtags.split(/\s+/).filter(tag => tag.trim());
            const hashtagCount = hashtagArray.length;

            document.getElementById('stat-caption-length').textContent = captionLength + 'ì';
            document.getElementById('stat-hashtag-count').textContent = hashtagCount + 'ê°œ';
            document.getElementById('caption-length').textContent = captionLength;
            document.getElementById('hashtag-count').textContent = hashtagCount;

            // ë°”ì´ëŸ´ ì ìˆ˜ ê³„ì‚° (ê°„ë‹¨í•œ ì•Œê³ ë¦¬ì¦˜)
            let viralScore = 50;
            if (captionLength >= 100 && captionLength <= 300) viralScore += 20;
            if (hashtagCount >= 5 && hashtagCount <= 15) viralScore += 15;
            if (caption.includes('!') || caption.includes('?')) viralScore += 10;
            if (hashtagArray.some(tag => tag.includes('íŠ¸ë Œë“œ') || tag.includes('í•«í”Œ') || tag.includes('ì¸ê¸°'))) viralScore += 5;

            document.getElementById('stat-viral-score').textContent = Math.min(viralScore, 100) + '/100';

            // ë„ë‹¬ë²”ìœ„ ì˜ˆì¸¡
            const reach = viralScore >= 80 ? 'ë§¤ìš° ë†’ìŒ' : viralScore >= 60 ? 'ë†’ìŒ' : viralScore >= 40 ? 'ë³´í†µ' : 'ë‚®ìŒ';
            document.getElementById('stat-reach').textContent = reach;

            // ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            const reachElement = document.getElementById('stat-reach');
            reachElement.className = viralScore >= 80 ? 'fw-bold text-success' : 
                                   viralScore >= 60 ? 'fw-bold text-info' : 
                                   viralScore >= 40 ? 'fw-bold text-warning' : 'fw-bold text-danger';
        }

        // ì½˜í…ì¸  ì¬ìƒì„±
        async function regenerateContent() {
            await generateContent();
        }

        // Instagram í¬ìŠ¤íŒ…
        async function postToInstagram() {
            const button = document.getElementById('post-btn');
            button.classList.add('loading');

            if (!currentContent.caption || !currentContent.imageUrl) {
                showToast('ë¨¼ì € ì½˜í…ì¸ ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.', 'warning');
                button.classList.remove('loading');
                return;
            }

            try {
                const response = await fetch('/api/post-instagram-final', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        caption: currentContent.caption + '\n\n' + currentContent.hashtags.join(' '),
                        image_url: currentContent.imageUrl
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('Instagram í¬ìŠ¤íŒ…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰', 'success');
                    
                    // ì„±ê³µ í†µê³„ ì—…ë°ì´íŠ¸
                    updatePostStats();
                } else {
                    showToast('í¬ìŠ¤íŒ… ì‹¤íŒ¨: ' + (data.detail?.message || data.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'danger');
                }
            } catch (error) {
                showToast('í¬ìŠ¤íŒ… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
                console.error('í¬ìŠ¤íŒ… ì˜¤ë¥˜:', error);
            } finally {
                button.classList.remove('loading');
            }
        }

        // AI ìº¡ì…˜ ìµœì í™”
        async function optimizeCaption() {
            const currentCaption = document.getElementById('caption-editor').value;
            if (!currentCaption) {
                showToast('ë¨¼ì € ìº¡ì…˜ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            showToast('AIê°€ ìº¡ì…˜ì„ ìµœì í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');

            // ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œë¡œëŠ” AI API í˜¸ì¶œ)
            setTimeout(() => {
                const optimizedCaption = currentCaption + '\n\nâœ¨ íŠ¹ë³„í•œ ìˆœê°„ì„ í•¨ê»˜ ë§Œë“¤ì–´ë³´ì„¸ìš”!';
                document.getElementById('caption-editor').value = optimizedCaption;
                updatePreview();
                showToast('ìº¡ì…˜ì´ ìµœì í™”ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            }, 2000);
        }

        // í•´ì‹œíƒœê·¸ ì¶”ì²œ
        function suggestHashtags() {
            const industry = document.getElementById('industry').value;
            const suggestions = {
                'restaurant': ['#ë§›ì§‘ì¶”ì²œ', '#ë¶„ìœ„ê¸°ì¢‹ì€ê³³', '#ë°ì´íŠ¸ì½”ìŠ¤', '#í˜¼ë°¥ë§›ì§‘', '#ê°ì„±ì¹´í˜'],
                'fashion': ['#ë°ì¼ë¦¬ë£©', '#íŒ¨ì…˜íŠ¸ë Œë“œ', '#ìŠ¤íƒ€ì¼ë§', '#ì˜·ìŠ¤íƒ€ê·¸ë¨', '#ootd'],
                'beauty': ['#ë·°í‹°íŒ', '#ìì—°ë©”ì´í¬ì—…', '#ìŠ¤í‚¨ì¼€ì–´', '#ê¸€ë¡œìš°ì—…', '#ì…€í”„ì¼€ì–´'],
                'fitness': ['#í™ˆíŠ¸ë ˆì´ë‹', '#ê±´ê°•í•œìƒí™œ', '#ìš´ë™ì¼ê¸°', '#í”¼íŠ¸ë‹ˆìŠ¤', '#ë‹¤ì´ì–´íŠ¸']
            };

            const recommended = suggestions[industry] || suggestions['restaurant'];
            const currentHashtags = document.getElementById('hashtags-editor').value;
            const newHashtags = currentHashtags + ' ' + recommended.join(' ');
            
            document.getElementById('hashtags-editor').value = newHashtags.trim();
            updatePreview();
            showToast('ì¶”ì²œ í•´ì‹œíƒœê·¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // ì´ë¯¸ì§€ ë³€ê²½
        function changeImage() {
            const newUrl = document.getElementById('image-url-editor').value;
            if (newUrl) {
                document.getElementById('preview-image').src = newUrl;
                currentContent.imageUrl = newUrl;
                showToast('ì´ë¯¸ì§€ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            }
        }

        // ì½˜í…ì¸  ë³µì‚¬
        async function copyContent() {
            const fullContent = currentContent.caption + '\n\n' + currentContent.hashtags.join(' ');
            
            try {
                await navigator.clipboard.writeText(fullContent);
                showToast('ì½˜í…ì¸ ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹', 'success');
            } catch (error) {
                showToast('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'danger');
            }
        }

        // ì½˜í…ì¸  ì €ì¥
        async function saveContent() {
            showToast('ì½˜í…ì¸ ë¥¼ ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
            
            // ì‹¤ì œ ì €ì¥ ë¡œì§ (ì‹œë®¬ë ˆì´ì…˜)
            setTimeout(() => {
                showToast('ì½˜í…ì¸ ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ’¾', 'success');
            }, 1000);
        }

        // ì½˜í…ì¸  ì´ˆê¸°í™”
        function resetContent() {
            document.getElementById('caption-editor').value = '';
            document.getElementById('hashtags-editor').value = '';
            document.getElementById('image-url-editor').value = '';
            
            currentContent = {
                caption: '',
                hashtags: [],
                imageUrl: '',
                businessName: ''
            };
            
            updatePreview();
            showToast('ì½˜í…ì¸ ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        // ì˜ˆì•½ í¬ìŠ¤íŒ…
        function schedulePost() {
            showToast('ì˜ˆì•½ í¬ìŠ¤íŒ… ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤! â°', 'info');
        }

        // í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadTemplate() {
            const templates = {
                'restaurant': {
                    caption: 'ğŸ½ï¸ ì˜¤ëŠ˜ë„ ì‹ ì„ í•œ ì¬ë£Œë¡œ ì •ì„±ìŠ¤ëŸ½ê²Œ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤! íŠ¹ë³„í•œ ë§›ì„ ê²½í—˜í•´ë³´ì„¸ìš”.',
                    hashtags: '#ë§›ì§‘ #ë§›ìŠ¤íƒ€ê·¸ë¨ #ì‹ ì„ í•œì¬ë£Œ #ì •ì„± #íŠ¹ë³„í•œë§›'
                },
                'fashion': {
                    caption: 'âœ¨ ìƒˆë¡œìš´ ì‹œì¦Œ, ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼! íŠ¸ë Œë””í•œ ë£©ìœ¼ë¡œ ë‹¹ì‹ ì˜ ë§¤ë ¥ì„ í‘œí˜„í•´ë³´ì„¸ìš”.',
                    hashtags: '#íŒ¨ì…˜ #ìŠ¤íƒ€ì¼ #íŠ¸ë Œë“œ #ootd #ë§¤ë ¥ì ì¸'
                }
            };

            const industry = document.getElementById('industry').value;
            const template = templates[industry] || templates['restaurant'];
            
            document.getElementById('caption-editor').value = template.caption;
            document.getElementById('hashtags-editor').value = template.hashtags;
            
            updatePreview();
            showToast('í…œí”Œë¦¿ì´ ë¶ˆëŸ¬ì™€ì¡ŒìŠµë‹ˆë‹¤!', 'success');
        }

        // ìµœê·¼ ì½˜í…ì¸  ë³´ê¸°
        function showHistory() {
            showToast('ì½˜í…ì¸  íˆìŠ¤í† ë¦¬ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤! ğŸ“š', 'info');
        }

        // Instagram í…ŒìŠ¤íŠ¸
        async function testInstagram() {
            showToast('Instagram ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
            
            try {
                const response = await fetch('/api/test-instagram-simple');
                const data = await response.json();
                
                if (data.success) {
                    showToast('Instagram ì—°ê²°ì´ ì •ìƒì…ë‹ˆë‹¤! âœ…', 'success');
                } else {
                    showToast('Instagram ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤: ' + data.error, 'warning');
                }
            } catch (error) {
                showToast('Instagram í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'danger');
            }
        }

        // ì„±ê³¼ ë¶„ì„
        function showAnalytics() {
            showToast('ì„±ê³¼ ë¶„ì„ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤! ğŸ“ˆ', 'info');
        }

        // í¬ìŠ¤íŒ… í†µê³„ ì—…ë°ì´íŠ¸
        function updatePostStats() {
            // ì„±ê³µí•œ í¬ìŠ¤íŒ… ìˆ˜ ì¦ê°€ ë“±ì˜ ë¡œì§
        }

        // í”„ë¡œí•„ ë³´ê¸°
        function showProfile() {
            showToast('í”„ë¡œí•„ ì„¤ì • ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤! ğŸ‘¤', 'info');
        }

        // ì„¤ì •
        function showSettings() {
            showToast('ì„¤ì • ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤! âš™ï¸', 'info');
        }

        // ë¡œê·¸ì•„ì›ƒ
        async function logout() {
            try {
                await fetch('/api/auth/logout', { method: 'POST' });
                window.location.href = '/login';
            } catch (error) {
                window.location.href = '/login';
            }
        }

        // í† ìŠ¤íŠ¸ ì•Œë¦¼
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            const toastId = 'toast-' + Date.now();
            
            const bgColor = {
                'success': 'bg-success',
                'danger': 'bg-danger', 
                'warning': 'bg-warning text-dark',
                'info': 'bg-info'
            }[type] || 'bg-info';

            const toastHTML = `
                <div id="${toastId}" class="toast align-items-center text-white ${bgColor} border-0" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement, { delay: 4000 });
            toast.show();
            
            // í† ìŠ¤íŠ¸ê°€ ìˆ¨ê²¨ì§„ í›„ DOMì—ì„œ ì œê±°
            toastElement.addEventListener('hidden.bs.toast', () => {
                toastElement.remove();
            });
        }

        // ì‹¤ì‹œê°„ ì…ë ¥ ê°ì§€
        document.getElementById('caption-editor').addEventListener('input', updatePreview);
        document.getElementById('hashtags-editor').addEventListener('input', updatePreview);
        document.getElementById('image-url-editor').addEventListener('change', updatePreview);
    </script>
</body>
</html>